## Fundamental of VLSI 2023
1. **Q：PMOS 和 NMOS 晶体管有相同的 $W$，$L$ 尺寸，并且他们的 $V_{GS}$，$V_{DS}$ 也相同，该电压使 PMOS 和 NMOS 同时处于饱和工作区，请问哪个晶体管的饱和电流更高，为什么？**

    答：NMOS 的饱和电流更高。这是因为 NMOS 中沟道载流子为电子，相比于 PMOS 的空穴而言迁移率更大，在相同电场强度下，电子的漂移速度更大。另一方面，由于 PMOS 和 NMOS 有相同的 $W$，$L$ 尺寸，它们工作在相同的饱和工作区，饱和电流与迁移率成正比，因此 NMOS 的饱和电流更高。

2. **Q：MOS 管的沟道设计长度 $L_d$ 为何与沟道实际长度 $L$（有效沟长）不同，原因何在？**

    答：因为 MOS 管的源区与漏区的扩散作用，导致有效的沟长 $L$ 比设计长度 $L_d$ 更短。

3. **Q：论述静态 CMOS 反相器的工作原理及其优点。**
    答：CMOS 反相器由一个 PMOS 和一个 NMOS 组成。当输入为高电压时，PMOS 截止，NMOS 导通，将输出下拉接地，从而形成稳态值 0V。反之，当输出为低电压时，PMOS 导通，NMOS 截止，将输出上拉接电源，从而形成稳态值 $V_{DD}$。它的优点如下：

    1. 输出的高低电平分别为 $V_{DD}$ 和 $\text{GND}$。换言之，电压摆幅等于电源电压。因此噪声容限很大。
    2. 逻辑电平与器件的相对尺寸无关，因此可以采用最小的晶体管尺寸。
    3. 稳态时在输出和 $V_{DD}$ 或 $\text{GND}$ 之间总存在一条具有有限电阻的通路。因此设计良好的 CMOS 反相器具有低输出阻抗，这使它对噪声和干扰不敏感。
    4. CMOS 反相器的输入阻抗极高，因为 MOS 管的栅是一个完全的绝缘体，因此不存在任何 dc（直流）输入电流。由于反相器的输入只连接到晶体管的栅上，因此稳态输入电流几乎为零。从而理论上单个反相器可以驱动无穷多个门而正确工作。
    5. 在稳态工作情况下电源线和地线之间没有直接的通路。没有电流存在（忽略漏电流）意味着该门并不消耗任何静态功率。

4. **Q：论述栅漏电容的密勒效应。**

    答：栅漏电容的密勒效应指的是当由低至高或由高至低的过渡中，栅漏电容两端的电压向相反的方向变化，因此在这一浮空电容上的电压变化是实际输出电压摆幅的两倍，从而可以用一个两倍于该电容值的接地电容来代替栅漏电容。

5. **Q：什么是 MOS 器件的体偏置效应，给出在体偏置条件下的 MOS 的阈值电压 $V_T$。**

    答：当在 MOS 器件的源与体之间加上一个衬底偏置电压 $V_{SB}$ 时，它使强反型所要求的表面电势增加并变为 $|-2\phi_F+V_{SB}|$。从而

    $$
    V_T=V_{T0}+\gamma (\sqrt{|(-2)\phi_F+V_{SB}|}-\sqrt{|2\phi_F|})
    $$

6. **Q：什么是扇入和扇出，说出扇入和扇出不能太大的原理。**

    答：扇入是门的输入的数目，扇出是链接到驱动门输出的负载门数目。增大扇入，将增加门的复杂性，可能增大其本身的等效电阻和本征电容，导致门的静态和动态特性变差。增大扇出，可能增大其负载电容，导致门延时上升。因此扇入和扇出不能太大。


7. **Q：说明门延时的概念。**

    答：考虑门的传播延时时，一般将其简化为一个 RC 模型，电阻为 MOS 管的等效电阻，电容为 MOS 管的本征电容加上负载电容。之所以门会产生延时，是因为通过电阻对电容进行充/放电不是在瞬间完成的，一般将电容充/放电到 $V_{DD}/2$ 的时间定义为门的延时。


8. **Q：简述门的驱动强度、尺寸、电流、电阻、电容之间的关系。**

    答：门的尺寸是在设计时确定的，影响它的驱动强度、电流等参数。一般来说，门的尺寸越大，驱动强度、电流、电容就越大，而电阻越小。

9.  **Q：一数字电路符合一阶 $\text{RC}$ 网络传播延时模型（如下图），$V_{in}$ 从 $0\to V_{DD}$ 的阶跃变化，求该数字电路 $v$ 从 $0.2V_{DD}\to 0.8V_{DD}$ 的时间。**

    答：电路中的电流为 $\displaystyle{i=C\frac{\mathrm{d}v}{\mathrm{d} t}}$，根据基尔霍夫电压定律，有

    $$V_{DD}-Ri=v$$
    $$V_{DD}-RC\frac{\mathrm{d}v}{\mathrm{d} t}=v$$
    $$RC\frac{\mathrm{d}v}{\mathrm{d} t}=V_{DD}-v$$
    $$\frac{\mathrm{d}v}{V_{DD}-v}=\frac{\mathrm{d}t}{RC}$$

    令 $u=V_{DD}-v$，$\tau=RC$，有

    $$-\frac{\mathrm{d}u}{u}=\frac{\mathrm{d}t}{\tau}$$

    两边同时积分，有

    $$-\int_{V_{DD}}^{V_{DD}-V_{out}}\frac{\mathrm{d}u}{u}=\int_{0}^{t}\frac{\mathrm{d}t}{\tau}$$
    $$-\ln{\frac{V_{DD}-V_{out}}{V_{DD}}}=\frac{t}{\tau}$$
    $$\frac{V_{DD}-V_{out}}{V_{DD}}=e^{-\frac{t}{\tau}}$$
    $$V_{out}=(1-e^{-\frac{t}{\tau}})V_{DD}$$

    求该数字电路 $v$ 从 $0.2V_{DD}\to 0.8V_{DD}$ 的时间 $t=(\ln{\frac{10}{2}}-\ln{\frac{10}{8}})\tau=\tau\ln{4}=1.4\tau$

10. **Q：静态 CMOS 反相器的器件参数如下：
NMOS：$V_{Tn}=0.4\text{V}$，$V_{DSATn}=0.63\text{V}$，$\mu_{n}C_{ox}=115\mu\text{A/V}^2$；PMOS：$V_{Tp}=-0.4\text{V}$，$V_{DSATp}=-1\text{V}$，$\mu_{p}C_{ox}=-30\mu\text{A/V}^2$；电源电压 $V_{DD}=2.5\text{V}$，实际沟道长度 $L_n=L_p=0.25\mu\text{m}$，**
    1. **请确定 $W_p/W_n$ 的比值，使反相器的开关阈值 $V_M=1.25\text{V}$（注：忽略沟长调制作用影响）；**

        答：在开关阈值为 $V_M$ 时，PMOS 和 NMOS 尺寸比值满足
        $$\frac{(W/L)_p}{(W/L)_n}=\frac{k_n^{\prime}V_{DSATn}(V_M-V_{Tn}-V_{DSATn}/2)}{k_p^{\prime}V_{DSATp}(V_{DD}-V_M+V_{Tp}+V_{DSATp}/2)}$$

        将数据代入，可得 $W_p/W_n=3.69$。
    2. **如果 $W_n/L_n=2$，$W_p/L_p=3$ 时（注：$\lambda_{n}=0.06\text{V}^{-1}$，$\lambda_{p}=-0.1\text{V}^{-1}$），求反相器的开关阈值 $V_M$ 和噪声容限 $NM_H$，$NM_L$；**

        答： 根据 
        $$k_nV_{DSATn}(V_M-V_{Tn}-\frac{V_{DSATn}}{2})(1+\lambda_nV_M)+ \\
        k_pV_{DSATp}(V_M-V_{DD}-V_{Tp}-\frac{V_{DSATp}}{2})(1+\lambda_{p}V_M-\lambda_{p}V_{DD})=0$$

        代入已知数据，阈值电压 $V_M=1.069\text{V}$。

        阈值点 NMOS 电流为
        
        $$I_D(V_M)=k_nV_{DSATn}\left(V_M-V_{Tn}-\frac{V_{DSATn}}{2}\right)(1+\lambda V_M)$$

        代入数据，可得 $I_D(V_M)=54.58\times 10^{-6}\text{A}$。

        阈值点的增益为

        $$g=-\frac{1}{I_D(V_M)}\frac{k_nV_{DSATn}+k_pV_{DSATp}}{\lambda _n-\lambda _p}$$

        代入数据，可得 $g=-26.9$。

        由此得如下 $V_{IL}$，$V_{IH}$，$NM_L$，$NM_H$ 的值：

        $$V_{IL}=1.02\text{V},V_{IH}=1.10\text{V},NM_L=1.02\text{V},NM_H=1.40\text{V}$$
    3. **如果两个完全相同的反相器串联，$W_n=0.75\mu\text{m}$、$L_n=0.25\mu\text{m}$，反相器下拉时的扩散电容 $C_{dp}=1.5\text{fF}$、$C_{dn}=0.66\text{fF}$，覆盖电容 $C_{gn}=0.76\text{fF}$、$C_{gp}=2.28\text{fF}$，连线电容 $C_W=0.12\text{fF}$ 近似计算由高到低的传播延时 $t_{pHL}$**

        答：由表 3.3 可得 $2.5\mu\text{m}$ 下的 NMOS 等效电阻为 $R_{eqn}=\frac{13\text{k}\Omega}{(W/L)_n}$，从而 $t_{pHL}=0.96\times \frac{13\text{k}\Omega}{(W/L)_n}\times 5.32\text{fF}=15.9\text{ps}$

11.   **Q：$0.6\mu\text{m}$ 工艺的 NMOS 晶体管 $t_{ox}=1\times 10^{-8}\text{m}$，$\epsilon_{ox}=3.5\times 10^{-11}\text{F/m}$，电子迁移率 $\mu_{n}=350\text{cm}^2\text{/V}\cdot\text{s}$，$W/L=2$，求 NMOS 增益。**
    答：NMOS 增益为
    $$k_n=\frac{\mu_{n}\epsilon_{ox}}{t_{ox}}\times\frac{W}{L}$$
    代入数据可得 $k_n=2.45\times 10^{-4}\text{F/V}$。

12.   **Q：两个包含 NMOS 晶体管电路（如下图所示），NMOS 的尺寸及电压情况如图中所标注，其余的工艺参数相同，NMOS 均工作在电阻区，通过公式推导，验证 $I_{DS1}=I_{DS2}$（流过两个串联的等长晶体管的电流等于流过一个两倍长度的晶体管的晶体管的电流）。**
    答：假设两种 NMOS 管的增益因子分别为 $k_{n1}, k_{n2}$，由已知满足
    $$2k_{n1}=k_{n2}$$
    对于两个串联的 NMOS，流过它们的电流相等，由于它们均工作在电阻区，有
    $$I_{DS2}=k_{n2}[(V_{DD}-V_1-V_T)(V_{DS}-V_1)-\frac{(V_{DS}-V_1)^2}{2}]=k_{n2}[(V_{DD}-V_T)V_1-\frac{V_1^2}{2}]$$
    合并同类项，可得
    $$2[(V_{DD}-V_T)V_1-\frac{V_1^2}{2}]=(V_{DD}-V_T)V_{DS}-\frac{V_{DS}^2}{2}$$
    两边同乘 $k_{n1}$，可得
    $$2k_{n1}[(V_{DD}-V_T)V_1-\frac{V_1^2}{2}]=k_{n1}[(V_{DD}-V_T)V_{DS}-\frac{V_{DS}^2}{2}]$$
    将 $2k_{n1}=k_{n2}$ 代入，可得
    $$I_{DS2}=k_{n2}[(V_{DD}-V_T)V_1-\frac{V_1^2}{2}]=k_{n1}[(V_{DD}-V_T)V_{DS}-\frac{V_{DS}^2}{2}]=I_{DS1}$$
    命题得证。

13.   **Q：NMOS 晶体管的工艺参数如下：$t_{ox}=2\times 10^{-8}\text{m}$，$W=10\mu\text{m}$，$L_{d}=1.5\mu\text{m}$，$x_d=0.25\mu\text{m}$，$L_s=5\mu\text{m}$，$x_j=0.4\mu\text{m}$，源区参杂浓度 $N_D=10^{20}\text{原子/cm}^3$，衬底参杂浓度 $N_A=10^{16} \text{原子/cm}^3$，沟道阻挡层参杂浓度 $N_{A}^+=10^{19} \text{原子/cm}^3$。计算在 $300\text{K}$ 的温度下，**
    1. **分别求在 $V_D=5\text{V}$ 和 $2.5\text{V}$ 时的漏区扩散电容；**

        答：底板单位面积电容为

        $$C_j=\sqrt{\left(\frac{\epsilon_{si}q}{2}\frac{N_AN_D}{N_A+N_D}\right)(\phi_{0}-V_D)^{-1}}$$

        其中在 $300\text{K}$ 下

        $$\phi_{0}=\frac{kT}{q}\ln\left[\frac{N_AN_D}{n_i^2}\right]=937\text{mV}$$

        同理，侧壁单位周长电容为

        $$C_{jsw}=x_j\sqrt{\left(\frac{\epsilon_{si}q}{2}\frac{N_A^+N_D}{N_A^++N_D}\right)(\phi_{0}^+-V_D)^{-1}}$$

        其中在 $300\text{K}$ 下

        $$\phi_{0}^+=\frac{kT}{q}\ln\left[\frac{N_A^+N_D}{n_i^2}\right]=1116\text{mV}$$

        总的漏区扩散电容（结电容）为

        $$C_{diff}=C_{bottom}+C_{sw}=C_jL_sW+C_{jsw}(2L_s+W)$$

        在 $V_D=5\text{V}$ 下，$C_j=0.119\times 10^{-3}\text{F/m}^2$，$C_{jsw}=2.12\times 10^{-9}\text{F/m}$，$C_{diff}=5.95\text{fF}+42.4\text{fF}=48.35\text{fF}$

        在 $V_D=2.5\text{V}$ 下，$C_j=0.156\times 10^{-3}\text{F/m}^2$，$C_{jsw}=2.76\times 10^{-9}\text{F/m}$，$C_{diff}=7.8\text{fF}+55.2\text{fF}=63\text{fF}$
    2. **求漏区的覆盖电容，$\epsilon_{ox}=3.5\times 10^{-11}\text{F/m}$。**

        答：覆盖电容为 $2C_{ox}x_dW=4.375\text{fF}$。

14.   **有三个反相器组成的反相器链，输入电容为 $C_1=1\text{pF}$，负载电容为 $C_L=1000\text{pF}$，如果第一个反相器的尺寸为 $1$，在反相器链传播延时最小情况下，传播延时 $t_{p1}$ 为 $70\text{ps}$（注：$\gamma=1$），**
    1. **请确定其他两个反相器 $I2$、$I3$ 的尺寸，使反相器链的传播延时最小，并计算该情况下的最小延时；**

        答：对于三级反相器，达到最小延时，需要保证每一级的放大倍数相等，从而放大倍数 $f$ 满足

        $$f^3=C_L/C_1=1000$$

        因此放大倍数 $f=10$，从而 $I_2$ 的尺寸为 $10$，$I_2$ 的尺寸为 $100$。

        根据 $t_{p1}=70\text{ps}$，以及 $t_{p1}=t_{p0}(1+f/\gamma)$，可知 $t_{p0}=\frac{t_{p1}}{1+f/\gamma}$。因此，反相器链的最小延时为 $t_p=Nt_{p0}(1+f/\gamma)=Nt_{p1}=210\text{ps}$。
    2. **如果允许增加更多的反相器使反相器链的延时最小，请确定插入反相器的数目，并计算该情况下的最小延时。**

        答：当 $\gamma = 1$ 时，最优的锥形系数约为 $f^{\prime}=3.6$，从而最优的反相器级数为

        $$N^{\prime}=\log_{3.6}{(C_L/C_1)}\approx 5$$

        此时的放大倍数为 $f=\sqrt[5]{1000}=3.98$

        该情况下的最小延时为 $t_p^{\prime}=N^{\prime}t_{p0}(1+f/\gamma)=158\text{ps}$。

15.   **Q：逻辑门驱动的数据总线位宽为 3bit，是由三根信号线 A、B、C 组成，两侧用地线屏蔽外部互联线串扰，总线的布线图、截面图及尺寸参数值如下图所示，其中 $W=0.4\mu\text{m}$，$S=0.6\mu\text{m}$，$H=0.4\mu\text{m}$，$T=0.6\mu\text{m}$，**
    1. **计算信号线的对地单位电容 $c_L$ 和信号线间的单位耦合电容 $c_C$，电介质介电常数$\epsilon=3.45$，（提示：电容计算公式为 $c=c_{pp}+c_{fringe}=\frac{\epsilon}{h}(w-\frac{t}{2})+\frac{2\pi\epsilon}{\log{(2h/t+1)}}$）**

        答：信号线对地单位电容为

        $$c_L=c_{pp}+c_{fringe}=\frac{\epsilon}{H}(W-\frac{T}{2})+\frac{2\pi\epsilon}{\log{(2H/T+1)}}=5.29\times 10^{-10}\text{F/m}$$

        信号线间的单位耦合电容为

        $$c_C=c_{pp}+c_{fringe}=\frac{\epsilon}{S}(T-\frac{W}{2})+\frac{2\pi\epsilon}{\log{(2S/W+1)}}=3.39\times 10^{-10}\text{F/m}$$
    2. **受到信号线 A 和 C 的电压变化影响，信号线 B 会出现耦合电容的变化，分析产生最大耦合电容和最小耦合电容的情况，画出两种情况下的信号线 A、B 和 C 的电压变化波形图，并用密勒效应来计算两种情况下信号线 B 的单位总电容 $C_T$；**

        答：当 A，C 两条导线的波形与 B 沿相反方向变化时，耦合电容最大，为 $c_L+4c_C$；当 A，C 两条导线的波形与 B 沿相同方向变化时，耦合电容最小，为 $c_L$。

        ![](img/wire.jpg)
    3. **总线材料为 Al，其电阻率$\rho=2.7\times 10^{-8}\Omega\cdot\text{m}$，计算信号线 B 的单位电阻；**

        答：信号线 B 的单位电阻为

        $$R_L=\frac{\rho L}{TW}\times\frac{1}{L}=\frac{\rho}{TW}=1.125\times 10^5\Omega\text{/m}$$
    4. **总线长度 $L=1.0\text{mm}$，用 Elmore 模型近似计算信号线 B 的最大延迟和最小延迟。**

        答：最大延迟为

        $$t_{max}=R(c_L+4c_C)=212.1\text{ps}$$

        最小延迟为

        $$t_{min}=Rc_L=59.5\text{ps}$$
16.  **Q：回答下列问题：**
    1. **用互补 CMOS 门实现逻辑功能为$Out=\overline{AB+AC+BC}$的电路；**

        答：![](img/CMOS.jpg)
    2. **用由 NMOS 构成下拉网络的多米诺门实现逻辑功能为$Out=\overline{AB+AC+BC}$的电路；**

        答：由德·摩根定律，有
        
        $$
        Out=\overline{AB}\cdot\overline{AC}\cdot\overline{BC}\\
        =(\overline{A}+\overline{B})(\overline{A}+\overline{C})(\overline{B}+\overline{C})
        $$
        
        ![](img/DCMOS.jpg)
    3. **写出下面 CMOS 电路的逻辑函数功能**

        答：当 $P=0$ 时，上面的传输门导通，$Out=\overline{AB}$；当 $P=1$ 时，下面的传输门导通，$Out=\overline{C}$。因此下面 CMOS 电路的逻辑函数功能为

        $$Out=P\cdot\overline{C}+\overline{P}\cdot\overline{AB}$$

17.  **TODO：Q：一个由两个相反类型的锁存器组成的寄存器（如下图所示），驱动端 $D$ 由一个反相器所驱动，所有的交叉偶合反相器的 $W_p/W_n=2$，并且 $W_p$ 和 $W_n$ 均是 $0.25\mu\text{m}$ 工艺的晶体管最小宽度尺寸，**
    1. **指出前后串联的锁存器的正负类型及该寄存器的正负沿类型；**

        答：前面的锁村器当 $CLK=1$ 时透明，因此为正锁存器，后面的同理为负锁存器。当 $CLK=1$ 时，前面的传输管导通，将 $D$ 的值写入前面的锁存器，后面的传输管断开，$Q$ 端输出后面锁存其存储的结果；当 $CLK=1\to 0$ 时，前面锁存器的结果写入后面锁存器，并输出到 $Q$。因此每个周期 $Q$ 的值为下降沿前 $D$ 的值，从而该寄存器为负沿触发。
    2. **由于该寄存器的时钟开关采用的是传输管结构，请确定传输管的最小尺寸限制，确保能够在输入端 $D$ 为“$0$”时，能够将其写入寄存器中（忽略沟道调制且如果发生漏电流饱和则为速度饱和，晶体管的其它参数参考教材表 3.2）；**
    3. **如果传输管的尺寸是确定的，并且不满足成功写入“$0$”的尺寸限制条件，如何采取其它方法来保证成功将“$0$”写入寄存器？**
    4. **如果传输管的延时是 $t_T$，反相器的延时是 $t_{INV}$，给出寄存器建立时间 $t_{SU}$，传输延迟 $t_{cq}$ 和维持时间 $t_{hold}$。**
18.   **Q：下图中组合逻辑电路的反相器 $a$ 的晶体管宽度 $W_n=1\mu\text{m}$，$W_p=2\mu\text{m}$，单位晶体管宽度的栅电容 $C_g=2\text{fF/}\mu\text{m}$，$C_{out}=200\text{fF}$，（注：参考表 6.5）**
    1. **从 In 到 Out 电路的总路径努力是多少?**

        答：各级逻辑努力和分支努力分别为

        |级数|门类型|逻辑努力 $g_i$|分支努力 $b_i$|
        |:---:|:---:|:---:|:---:|
        |1|反相器|$1$|$1$|
        |2|2 输入 NAND 门|$4/3$|$3/1$|
        |3|3 输入 NOR 门|$7/3$|$1$|
        |4|4 输入 NAND 门|$4/3$|$4/1$|
        |5|反相器|$1$|$1$|
        |6|2 输入 NOR 门|$5/3$|$1$|

        路径逻辑努力 $G$ 为

        $$G=\Pi_{1}^{6}g_i=560/81$$

        路径分支努力 $B$ 为

        $$B=\Pi_{1}^{6}b_i=12$$

        第一级反相器的输入电容 $C_{g1}$ 为

        $$C_{g1}=(W_p+W_n)C_g=6\text{fF}$$

        路径等效扇出 $F$ 为

        $$F=C_{out}/C_{g1}=100/3$$

        总路径努力 $H$ 为

        $$H=GFB=224000/81 $$
    2. **使路径延时最小的门努力是多少？**

        答：使路径延时最小的门努力 $h$ 为

        $$h=\sqrt[6]{H}=3.75$$

